var ajaxStandard,control_validator,dialog_info,dialog_tips,dialog_validator,initPop,label_tips,popupBase,popupDialog,popup_html,reset_api_button,reset_dialog_button,top_position,url_hash;url_hash=[],top_position=0,popup_html='<div id="popup-dialog" class="modal fade">\n  <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">Modal title</h4>\n            </div>\n            <div class="modal-body clearfix">\n                <p>One fine body&hellip;</p>\n            </div>\n            <div class="modal-info"></div>\n            <div class="modal-footer">\n                <button id=\'modal-return\' type="button" class="btn btn-default" data-dismiss="modal">取 消</button>\n                <button id="proceed" type="button" class="btn btn-primary">确 定</button>\n            </div>\n        </div><!-- /.modal-content -->\n  </div><!-- /.modal-dialog -->\n</div><!-- /.modal -->',control_validator=function(n,o,e){var t,l,a,r,i;if(r=$("#"+n),r.keypress(function(){return dialog_info("","none"),r.removeClass("user-error")}),i=$.trim(r.val()),!i||!i.length)return dialog_info(o+"不得为空！","error"),r.focus(),r.addClass("user-error"),reset_api_button(),!1;for(t=0,a=e.length;a>t;t++){if(l=e[t],i.match(l.regex))return dialog_info(""+o+l.alert,"error"),r.focus(),r.addClass("user-error"),reset_api_button(),!1;r.removeClass("user-error"),dialog_info("","none")}return!0},ajaxStandard=function(n,o,e,t,l){var a,r,i,d;null==e&&(e="GET"),null==t&&(t={}),null==l&&(l=!0),a={rand:Math.random().toString(36).substring(7)};for(i in o)d=o[i],a[i]=d;return r=$.Deferred(),("POST"===e||"DELETE"===e||"PUT"===e)&&null==a.csrfmiddlewaretoken&&(t["X-CSRFToken"]=a.csrfmiddlewaretoken=$("input[name='csrfmiddlewaretoken']").attr("value")),$.ajax({url:n,data:a,type:e,beforeSend:function(n){var o,e;e=[];for(o in t)e.push(n.setRequestHeader(o,t[o]));return e},async:l}).done(function(n,o,e){return 401===n.code?window.location.href="/users/session_expire":r.resolve(n,o,e)}).fail(function(n){return r.reject(n)}),r.promise()},initPop=function(n){var o,e,t,l,a;for(l=["title","body","info"],e=0,t=l.length;t>e;e++)o=l[e],a="#popup-dialog .modal-"+o,$(a).html(n[o]);return null!=n.button_hot&&$("#proceed").addClass("btn-hot"),null!=n.button_text&&$("#proceed").html(n.button_text),null!=n.popName&&($(".modal-dialog").addClass(n.popName),$(".modal-footer").addClass("hidden")),null!=n.className&&$(".modal-dialog").addClass(n.className),url_hash.push(window.location.hash)},reset_api_button=function(){return $("#proceed").removeClass("btn-disabled").addClass("btn-primary")},popupBase=function(n){var o;return $("#popup-dialog").remove(),null!=(o=$(".modal-backdrop.fade.in"))&&o.remove(),$("html").append(popup_html),null!=n.topValue&&$("#popup-dialog.fade .modal-dialog").css("top",n.topValue),$(".modal-header button.close").click(function(){var n;return null!=(n=$(".modal-backdrop.fade.in"))?n.remove():void 0}),$("#popup-dialog").on("show.bs.modal",function(){return $("#popup-dialog").attr("tabindex",1).focus(),initPop(n),null!=n.init&&n.init(),null!=n.reload&&n.reload?$("#popup-dialog").on("hidden",function(){return loadUrl($("#main-zone").attr("url-base")+window.location.search),window.location.hash=url_hash.pop()}):void 0}),$("#popup-dialog").on("shown.bs.modal",function(){return $("#popup-dialog").removeAttr("tabindex"),$("#proceed").click(function(o){return $("#proceed").hasClass("btn-disabled")||"proceedSoldout"===$(o.target).attr("id")?void 0:($("#proceed").removeClass("btn-primary").addClass("btn-disabled"),n.api())}),$('.nav-tabs a[data-toggle="tab"]').click(function(){var n;return n=$(".nav-tabs li.active a").attr("href"),"#system-templates"===n?$(".sys-detail").html($.trim($("#os-name").html()+" "+$("#version-no").html())):"#personal-templates"===n?0===$("#personal_image_select option:checked").length?$(".sys-detail").html("未创建模板"):$(".sys-detail").html($("#personal_image_select option:checked").attr("os")+" "+$("#personal_image_select option:checked").attr("version")):void 0}),$("#thresholdForm").change(function(){return n.changeUnit()})}),$("#popup-dialog").modal()},dialog_info=function(n,o,e,t){var l;return null==o&&(o="success"),null==e&&(e=0),null==t&&(t=null),"error"===o&&(o="danger"),null==o||"success"!==o&&"warning"!==o&&"danger"!==o||(n="<div class='alert alert-"+o+"'>"+n+'<span id="count-down" class="text-muted"></div>'),$("#popup-dialog .modal-info").html(n),e>0?(l=setInterval(function(){return--e,$("#count-down").html(" ("+e+"秒后关闭对话框)")},1e3),setTimeout(function(){return clearInterval(l),$("#popup-dialog").modal("hide"),null!=t?t():void 0},1e3*e)):void 0},dialog_validator=function(n,o,e,t){var l,a,r,i,d;if(null==n&&(n=""),i=$("#"+o),i.keypress(function(){return dialog_tips(n,"","none"),i.removeClass("user-error")}),d=$.trim(i.val()),!d||!d.length)return dialog_tips(n,e+"不得为空！","error"),i.focus(),i.addClass("user-error"),reset_dialog_button(n),!1;for(l=0,r=t.length;r>l;l++){if(a=t[l],d.match(a.regex))return dialog_tips(n,""+e+a.alert,"error"),i.focus(),i.addClass("user-error"),reset_dialog_button(n),!1;i.removeClass("user-error"),dialog_tips(n,"","none")}return!0},reset_dialog_button=function(n){return null==n&&(n=""),$("."+n+" .popup-confirm").removeClass("btn-disabled").addClass("btn-primary")},dialog_tips=function(n,o,e,t,l){var a;return null==n&&(n=""),null==e&&(e="success"),null==t&&(t=0),null==l&&(l=null),"error"===e&&(e="danger"),null==e||"success"!==e&&"warning"!==e&&"danger"!==e||(o="<div class='alert alert-"+e+"'>"+o+'<span id="count-down" class="text-muted"></div>'),$("."+n+" .modal-info").html(o),"danger"===e&&$("."+n+" .popup-confirm").removeClass("btn-disabled").addClass("btn-primary"),t>0?(a=setInterval(function(){return--t,$("#count-down").html(" ("+t+"秒后关闭对话框)")},1e3),setTimeout(function(){return clearInterval(a),$("."+n).remove(),null!=l?l():void 0},1e3*t)):void 0},popupDialog=function(n){var o,e,t;return o={parentContainer:$("html"),dialogName:"",dialogTitle:null,noFooter:!1,button_text:"确 定",innerHtml:"",zIndex:1500,top:45,init:null,api:null,close:null,closeThen:null,_clearModal:null},t=$.extend({},o,n),e='<div class="popupdialog-container '+t.dialogName+'" style="z-index:'+t.zIndex+';">\n    <div class="popupdialog" style="top:'+t.top+'px;">\n        <div class="popupdialog-content">\n            <div class="popup-header">\n                <h4 class="modal-title">'+t.dialogTitle+'</h4>\n            </div>\n            <div class="popup-content clearfix">\n                '+t.innerHtml+'\n            </div>\n            <div class="modal-info"></div>\n            <div class="popup-footer">\n                <button type="button" class="popup-return btn btn-default" data-dismiss="modal">取 消</button>\n                <button type="button" class="popup-confirm btn btn-primary">'+t.button_text+'</button>\n            </div>\n            <div class="popup-close">×</div>\n        </div>\n    </div>\n</div>',t.parentContainer.append(e),t.noFooter&&$(".popup-footer").addClass("hidden"),null!=t.init&&t.init(),$(".popup-close").click(function(n){return null!=t.closeThen&&t.closeThen(),$("."+t.dialogName).remove()}),$(".popup-return").click(function(n){return null!=t.close&&t.close(),$("."+t.dialogName).remove()}),$(".popup-confirm").click(function(n){return $(n.target).hasClass("btn-disabled")?void 0:($(n.target).removeClass("btn-primary").addClass("btn-disabled"),t.api())})},label_tips=function(n,o,e,t,l){return null==o&&(o=""),null==e&&(e="success"),null==t&&(t=0),null==l&&(l=null),n.html(o),n.removeClass("label-success label-warning label-danger label-info"),n.addClass("label-"+e),t>0?setTimeout(function(){return n.removeClass("label-"+e),n.addClass("hidden"),null!=l?l():void 0},1e3*t):void 0};